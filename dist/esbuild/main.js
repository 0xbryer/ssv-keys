var L=Object.create;var P=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var H=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var M=(i,e)=>{for(var r in e)P(i,r,{get:e[r],enumerable:!0})},R=(i,e,r,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of W(e))!V.call(i,s)&&s!==r&&P(i,s,{get:()=>e[s],enumerable:!(t=C(e,s))||t.enumerable});return i};var S=(i,e,r)=>(r=i!=null?L(H(i)):{},R(e||!i||!i.__esModule?P(r,"default",{value:i,enumerable:!0}):r,i)),j=i=>R(P({},"__esModule",{value:!0}),i);var c=(i,e,r)=>new Promise((t,s)=>{var a=h=>{try{n(r.next(h))}catch(m){s(m)}},o=h=>{try{n(r.throw(h))}catch(m){s(m)}},n=h=>h.done?t(h.value):Promise.resolve(h.value).then(a,o);n((r=r.apply(i,e)).next())});var $={};M($,{Encryption:()=>l,EthereumKeyStore:()=>A,SSVKeys:()=>f,SSVKeysV2:()=>E,SSVNetworkContract:()=>b,Threshold:()=>K});module.exports=j($);var D=S(require("web3")),_=require("js-base64"),F=S(require("eth2-keystore-js"));var u=require("bls-eth-wasm/browser/bls"),g=class{constructor(){this.validatorShares=[]}static get DEFAULT_SHARES_NUMBER(){return 4}static get DEFAULT_THRESHOLD_NUMBER(){return 3}create(s){return c(this,arguments,function*(e,r=g.DEFAULT_SHARES_NUMBER,t=g.DEFAULT_THRESHOLD_NUMBER){return new Promise((a,o)=>{try{u.init(u.BLS12_381).then(()=>{let n=[],h=[];this.validatorPrivateKey=u.deserializeHexStrToSecretKey(e),this.validatorPublicKey=this.validatorPrivateKey.getPublicKey(),n.push(this.validatorPrivateKey),h.push(this.validatorPublicKey);for(let p=1;p<t;p+=1){let y=new u.SecretKey;y.setByCSPRNG(),n.push(y);let d=y.getPublicKey();h.push(d)}for(let p=1;p<=r;p+=1){let y=new u.Id;y.setInt(p);let d=new u.SecretKey;d.share(n,y);let B=new u.PublicKey;B.share(h,y),this.validatorShares.push({privateKey:`0x${d.serializeToHexStr()}`,publicKey:`0x${B.serializeToHexStr()}`,id:y})}let m={validatorPrivateKey:`0x${this.validatorPrivateKey.serializeToHexStr()}`,validatorPublicKey:`0x${this.validatorPublicKey.serializeToHexStr()}`,shares:this.validatorShares};a(m)})}catch(n){o(n)}})})}},K=g;var T=S(require("jsencrypt")),O=require("js-base64"),l=class{constructor(e,r){this.RAW_OPERATOR_PUBLIC_KEY_SIGNATURE=RegExp(/------BEGIN RSA PUBLIC KEY-----/,"gmi");this.operators=e.map(t=>this.RAW_OPERATOR_PUBLIC_KEY_SIGNATURE.test(t)?t:(0,O.decode)(t)),this.shares=r}encrypt(){let e=[];return Object.keys(this.operators).forEach(r=>{let t=new T.default({});t.setPublicKey(this.operators[r]);let s=t.encrypt(this.shares[r].privateKey),a={operatorPublicKey:this.operators[r],privateKey:String(s),publicKey:this.shares[r].publicKey};return e.push(a),a}),e}};var v=class{constructor(){this.web3Instances={}}getWeb3(e=process.env.NODE_URL||""){return this.web3Instances[e]||(this.web3Instances[e]=new D.default(String(e||""))),this.web3Instances[e]}getPrivateKeyFromKeystoreData(e,r){return c(this,null,function*(){try{try{e=JSON.parse(e)}catch(s){}return yield new F.default(e).getPrivateKey(r).then(s=>s)}catch(t){return console.error(t),t}})}createThreshold(e){return c(this,null,function*(){try{return new K().create(e)}catch(r){return console.error(r),r}})}encryptShares(s,a){return c(this,arguments,function*(e,r,t=v.OPERATOR_FORMAT_BASE64){try{let o=e.map(n=>(n=atob(n),t==v.OPERATOR_FORMAT_BASE64?String((0,_.encode)(n)):n));return new l(o,r).encrypt()}catch(o){return console.error(o),o}})}abiEncode(e,r){return e.map(t=>this.getWeb3().eth.abi.encodeParameter("string",Object(t)[r]))}buildPayload(e,r){return c(this,null,function*(){let t=yield this.createThreshold(e),s=this.abiEncode(r,"operatorPublicKey"),a=r.map(n=>n.publicKey),o=this.abiEncode(r,"privateKey");return[t.validatorPublicKey,s,a,o]})}},f=v;f.OPERATOR_FORMAT_BASE64="base64";var E=class extends f{buildPayloadV2(e,r,t,s){return c(this,null,function*(){let a=yield this.createThreshold(e),o=t.map(h=>h.publicKey),n=this.abiEncode(t,"privateKey");return[a.validatorPublicKey,`[${r.join(",")}]`,o,n,s]})}};var U=S(require("web3")),b=class{constructor(){this.contractAddress="";this.nodeUrl="";this.contracts={};this.web3Instances={}}getWeb3(e=process.env.NODE_URL||""){return this.web3Instances[e]||(this.web3Instances[e]=new U.default(String(e||""))),this.web3Instances[e]}getLiquidationCollateral(){return c(this,null,function*(){return this.getContract().methods.minimumBlocksBeforeLiquidation().call()})}getNetworkFee(){return c(this,null,function*(){return this.getContract().methods.networkFee().call()})}getContract(){return this.contracts[this.contractAddress]||(this.contracts[this.contractAddress]=this.getWeb3(this.nodeUrl)),this.contracts[this.contractAddress]}setContractAddress(e){this.contractAddress=e}setNodeUrl(e){this.nodeUrl=e}};b.BLOCKS_PER_YEAR=2398050;var x=S(require("crypto")),N=require("scrypt-js"),w=S(require("ethereumjs-wallet")),k=require("ethereumjs-util"),I=class{constructor(e){this.privateKey="";if(!e)throw new Error("Key store data should be JSON or string");if(this.keyStoreData=JSON.parse(String(e)),!this.keyStoreData.version)throw new Error("Invalid keystore file")}getPublicKey(){var e;if(this.keyStoreData)switch((e=this.keyStoreData.version)!=null?e:this.keyStoreData.Version){case 1:return this.keyStoreData.Address;case 3:return this.keyStoreData.id;case 4:return this.keyStoreData.pubkey}return""}getPrivateKey(e=""){return c(this,null,function*(){if(this.privateKey)return this.privateKey;switch(this.keyStoreData.version){case 1:this.wallet=yield w.default.fromV1(this.keyStoreData,e);break;case 3:this.wallet=yield w.default.fromV3(this.keyStoreData,e,!0);break;case 4:this.wallet=yield this.fromV4(this.keyStoreData,e);break}if(this.wallet&&(this.privateKey=this.wallet.getPrivateKey().toString("hex"),!this.privateKey))throw new Error("Invalid password");return this.privateKey})}fromV4(e,r){return c(this,null,function*(){let t=typeof e=="object"?e:JSON.parse(e);if(t.version!==4)throw new Error("Not a V4 wallet");let s,a;if(t.crypto.kdf.function==="scrypt")a=t.crypto.kdf.params,s=yield(0,N.scrypt)(Buffer.from(r),Buffer.from(a.salt,"hex"),a.n,a.r,a.p,a.dklen);else if(t.crypto.kdf.function==="pbkdf2"){if(a=t.crypto.kdf.params,a.prf!=="hmac-sha256")throw new Error("Unsupported parameters to PBKDF2");s=x.default.pbkdf2Sync(Buffer.from(r),Buffer.from(a.salt,"hex"),a.c,a.dklen,"sha256")}else throw new Error("Unsupported key derivation scheme");let o=Buffer.from(t.crypto.cipher.message,"hex"),n=Buffer.concat([Buffer.from(s.slice(16,32)),o]);if({keccak256:k.keccak256,sha256:k.sha256}[t.crypto.checksum.function](n).toString("hex")!==t.crypto.checksum.message)throw new Error("Invalid password");let y=x.default.createDecipheriv(t.crypto.cipher.function,s.slice(0,16),Buffer.from(t.crypto.cipher.params.iv,"hex")),d=this.runCipherBuffer(y,o);return new w.default(d)})}runCipherBuffer(e,r){return Buffer.concat([e.update(r),e.final()])}static toHexString(e){return Array.from(e,r=>`0${(r&255).toString(16)}`.slice(-2)).join("")}},A=I;0&&(module.exports={Encryption,EthereumKeyStore,SSVKeys,SSVKeysV2,SSVNetworkContract,Threshold});
